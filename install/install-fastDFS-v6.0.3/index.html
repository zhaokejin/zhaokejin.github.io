<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="小小冒险家的博客">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://www.cicoding.cn">
    <!--SEO-->

    <meta name="keywords" content="FastDFS">


    <meta name="description" content="什么是FastDFS？FastDFS是一个开源的分布式文件系统，她对文件进行管理，功能包括：文件存储、文件同步、文件访问（文件上传、文件下载）等，解决了大容量存储和负载均衡的问题。特别适合以文件为载体的在线服务，如相册网站、视频网站等等。
FastDFS是一个应用级分布式文件存储服务，其采用中...">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">
    <!--Title-->


<title>CentOS 7 安裝FastDFS V6.0.3 | 小小冒险家的博客</title>


    <link rel="alternate" href="/atom.xml" title="小小冒险家的博客" type="application/atom+xml">


    <link rel="icon" href="/favicon.png">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/jquery.fancybox.css?v=2.1.5">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    



    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?601ebec7733383ef248ca61fc0a0db95";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>



    

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    
    <nav class="main-navigation">
    <div class="container">
        <div class="row clearfix">
            <div class="col-md-12 column">
                <nav class="navbar navbar-default" style="background-color:#fff;border:0;margin-bottom:0"
                     role="navigation">
                    <div class="navbar-header">
<!--                        <button type="button" class="navbar-toggle" data-toggle="collapse"-->
<!--                                data-target="#navbar-collapse-1">-->
<!--                            <span class="sr-only">切</span>-->
<!--                            <span class="icon-bar"></span>-->
<!--                            <span class="icon-bar"></span>-->
<!--                            <span class="icon-bar"></span>-->
<!--                        </button>-->
                        <a class="logo" href="/">
                            <img src="/favicon.png"/>小小冒险家的博客
                        </a>
                    </div>

                    <div class="collapse navbar-collapse" style="border:0;" id="navbar-collapse-1">
                        <ul class="nav navbar-nav">
                            
                                
                                    <li>
                                        <a href="/" >
                                            <i class="fa fa-home"></i>
                                            首页
                                        </a>
                                    </li>
                                
                            
                                
                                    <li>
                                        <a href="/archives" >
                                            <i class="fa fa-sort"></i>
                                            归档
                                        </a>
                                    </li>
                                
                            
                                
                                    <li class="dropdown">
                                        <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                                           data-hover="dropdown">
                                            <i class="fa fa-fire"></i>
                                            系列教程
                                            <strong class="caret"></strong>
                                        </a>
                                        <ul class="dropdown-menu">
                                            
                                                <li>
                                                    <a href="/docker/00-docker-lession-index" target="_blank">
                                                        <i class="fa "></i>
                                                        Docker系列教程
                                                    </a>
                                                </li>
                                            
                                                <li>
                                                    <a href="/micro-service/microservice/" target="_blank">
                                                        <i class="fa "></i>
                                                        SpringCloud微服务架构
                                                    </a>
                                                </li>
                                            
                                                <li>
                                                    <a href="/micro-service/microservice-alibaba/" target="_blank">
                                                        <i class="fa "></i>
                                                        SpringCloud Alibaba微服务架构
                                                    </a>
                                                </li>
                                            
                                                <li>
                                                    <a href="/sharding-jdbc/sharding-jdbc000/" target="_blank">
                                                        <i class="fa "></i>
                                                        Sharding-JDBC教程
                                                    </a>
                                                </li>
                                            
                                                <li>
                                                    <a href="/springboot/springboot-source-code/" target="_blank">
                                                        <i class="fa "></i>
                                                        SpringBoot源码系列
                                                    </a>
                                                </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="dropdown">
                                        <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                                           data-hover="dropdown">
                                            <i class="fa fa-book"></i>
                                            在线文档
                                            <strong class="caret"></strong>
                                        </a>
                                        <ul class="dropdown-menu">
                                            
                                                <li>
                                                    <a href="https://spring.io/docs/" target="_blank">
                                                        <i class="fa "></i>
                                                        Spring Reference
                                                    </a>
                                                </li>
                                            
                                                <li>
                                                    <a href="https://spring.io/projects/spring-boot/" target="_blank">
                                                        <i class="fa "></i>
                                                        SpringBoot Reference
                                                    </a>
                                                </li>
                                            
                                                <li>
                                                    <a href="https://spring.io/projects/spring-cloud/" target="_blank">
                                                        <i class="fa "></i>
                                                        SpringCloud Reference
                                                    </a>
                                                </li>
                                            
                                                <li>
                                                    <a href="https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/" target="_blank">
                                                        <i class="fa "></i>
                                                        Spring Security Reference
                                                    </a>
                                                </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li>
                                        <a href="/other/jrebel-activation" >
                                            <i class="fa fa-fire"></i>
                                            JRebel激活
                                        </a>
                                    </li>
                                
                            
                                
                                    <li>
                                        <a href="/about" >
                                            <i class="fa fa-user"></i>
                                            关于我
                                        </a>
                                    </li>
                                
                            
                        </ul>
                        
                            <form id="search-form" class="navbar-form navbar-right">
                                <div class="form-group input-group">
                                    <input type="text" id="local-search-input" class="form-control"
                                           placeholder="搜我..."/>
                                    <span class="input-group-btn">
                                        <a class="btn btn-default">
                                            <i class="fa fa-search"></i>
                                        </a>
                                    </span>
                                </div>
                                <div id="local-search-result" class="local-search-result-cls"></div>
                            </form>
                        
                    </div>
                </nav>
            </div>
        </div>
    </div>
</nav>

    <a href="http://github.com/zhaokejin" target="_blank">
        <img style="position: absolute; width:100px; top: 0; left: 0; border: 0;"
             src="/img/fork-me.png"
             alt="Fork me on GitHub">
    </a>


    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    
    
        <div class="ad">
            <div class="row">
                
                    <div class="col-md-12">
                        <a href="https://promotion.aliyun.com/ntms/act/qwbk.html?userCode=qhtujh03" rel="nofollow" target="_blank">
                            <img class="img-responsive center-block"
                                 src="/icons/810x100.png"
                                 title="阿里全民云计算"
                            >
                        </a>
                    </div>
                
            </div>
        </div>
    


<p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="CentOS 7 安裝FastDFS V6.0.3">
            
                CentOS 7 安裝FastDFS V6.0.3
            
        </h1>
        <div class="post-meta">
    

    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/安装教程/">安装教程</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-link" href="/tags/FastDFS/">FastDFS</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2019/12/12</span>
        </span>
        
            <span class="fa-wrap">
                <i class="fa fa-eye"></i>
                <span id="busuanzi_value_page_pv"></span>
            </span>
        
    
</div>
        
        
    </div>
    
    <div class="post-body post-content" id="container">
        
    <div class="toc-article">
        <strong>
            目录
        </strong>
        <div class="toc-content">
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#什么是FastDFS？"><span class="toc-text">什么是FastDFS？</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-小文件存储性能优化"><span class="toc-text">1.小文件存储性能优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-FastDFS文件名策略"><span class="toc-text">2. FastDFS文件名策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#准备好四个文件"><span class="toc-text">准备好四个文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CentOS-7-FastDFS搭建"><span class="toc-text">CentOS 7 FastDFS搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装libfastcommon"><span class="toc-text">安装libfastcommon</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装FastDFS"><span class="toc-text">安装FastDFS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装tracker"><span class="toc-text">安装tracker</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建tracker工作目录"><span class="toc-text">创建tracker工作目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置tracker"><span class="toc-text">配置tracker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动tracker"><span class="toc-text">启动tracker</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装storage"><span class="toc-text">安装storage</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#为storage配置工作目录"><span class="toc-text">为storage配置工作目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#修改storage配置文件"><span class="toc-text">修改storage配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动storage"><span class="toc-text">启动storage</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#校验整合"><span class="toc-text">校验整合</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#测试"><span class="toc-text">测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#配置客户端"><span class="toc-text">配置客户端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模拟上传"><span class="toc-text">模拟上传</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP访问文件"><span class="toc-text">HTTP访问文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP请求不能访问文件的原因"><span class="toc-text">HTTP请求不能访问文件的原因</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#FastDFS的nginx模块安装"><span class="toc-text">FastDFS的nginx模块安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装nginx准备"><span class="toc-text">安装nginx准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装nginx并添加fastdfs-nginx-module"><span class="toc-text">安装nginx并添加fastdfs-nginx-module</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置storage-nginx"><span class="toc-text">配置storage nginx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置tracker-nginx"><span class="toc-text">配置tracker nginx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP测试"><span class="toc-text">HTTP测试</span></a></li></ol></li></ol>
        </div>
    </div>


        <h1 id="什么是FastDFS？"><a href="#什么是FastDFS？" class="headerlink" title="什么是FastDFS？"></a>什么是FastDFS？</h1><p>FastDFS是一个开源的分布式文件系统，她对文件进行管理，功能包括：文件存储、文件同步、文件访问（文件上传、文件下载）等，解决了大容量存储和负载均衡的问题。特别适合以文件为载体的在线服务，如相册网站、视频网站等等。</p>
<p>FastDFS是一个应用级分布式文件存储服务，其采用中心型结构（类似GFS、HDFS、TFS等），主要用于大中型网站存储资源文件。FastDFS具有轻量级，支持高并发放访问，负载均衡，可扩展等优点。而FastDFS最大的亮点就是对小文件的存储性能较好，这主要来自于其文件名策略。</p>
<h2 id="1-小文件存储性能优化"><a href="#1-小文件存储性能优化" class="headerlink" title="1.小文件存储性能优化"></a>1.小文件存储性能优化</h2><p>小文件的性能瓶颈主要来自于对元数据服务器（如FastDFS中的TrackerServer或TFS中的NameServer）的访问，因为当文件本身大小很小时，元数据存储所占空间与文件内容存储所占空间的比例就变得较大，访问元数据所消耗资源与访问文件内容所消耗资源的比例也变得较大。因此，通常对小文件存储的优化方法主要有两大类思路：一是减少访问元数据的次数，比如Cache预取；二是减少元数据所占的存储空间，比如FastDFS使用的文件名策略。</p>
<h2 id="2-FastDFS文件名策略"><a href="#2-FastDFS文件名策略" class="headerlink" title="2. FastDFS文件名策略"></a>2. FastDFS文件名策略</h2><p>FastDFS中的文件名是在向StorageServer存储文件时由系统指定的，文件名中包含了VolumeID和FileID。也就是说，当客户要读取某个文件时，通过在客户端对文件名进行解析，就可以知道该文件存储在哪个Volume上和它在StorageServer中的FileID。但是此时用户还不能读取文件，因为他不知道Volume内各个StorageServer的ip地址，也不知道应该从Volume内的哪个StorageServer中读取。所以用户需手持欲访问的文件的VolumeID向TrackerServer询问，TrackerServe会均衡当前各StorageServer的IO负载状况，返回一个最佳的StorageServer的ip地址。最后用户与该StorageServer连接，出示欲访问文件的FileID，StorageServer上会维持一个FileID对应偏移量的表，从而得到欲访问文件的偏移量。</p>
<p>可见，FastDFS的文件名策略将文件存储位置信息隐含在文件名中，从而减少了元数据量，达到了优化小文件存储性能的作用。</p>
<p><img src="/images/install/clip_image001.png" alt="CentOS 7 安裝FastDFS"></p>
<p>FastDFS服务端有两个角色：跟踪器（tracker）和存储节点（storage）。跟踪器主要做调度工作，在访问上起负载均衡的作用。</p>
<p>上传交互过程编辑</p>
<ol>
<li><p>client询问tracker上传到的storage，不需要附加参数；</p>
</li>
<li><p>tracker返回一台可用的storage；</p>
</li>
<li><p>client直接和storage通讯完成文件上传。</p>
</li>
</ol>
<p>FastDFS file download</p>
<p>下载交互过程编辑</p>
<ol>
<li><p>client询问tracker下载文件的storage，参数为文件标识（卷名和文件名）；</p>
</li>
<li><p>tracker返回一台可用的storage；</p>
</li>
<li><p>client直接和storage通讯完成文件下载。</p>
</li>
</ol>
<p>需要说明的是，client为使用FastDFS服务的调用方，client也应该是一台服务器，它对tracker和storage的调用均为服务器间的调用。</p>
<p>存储节点存储文件，完成文件管理的所有功能：存储、同步和提供存取接口，FastDFS同时对文件的meta data进行管理。所谓文件的meta data就是文件的相关属性，以键值对（key value pair）方式表示，如：width=1024，其中的key为width，value为1024。文件meta data是文件属性列表，可以包含多个键值对。</p>
<p>FastDFS系统结构如下图所示：</p>
<p><img src="/images/install/clip_image002.jpg" alt="CentOS 7 安裝FastDFS"></p>
<h2 id="准备好四个文件"><a href="#准备好四个文件" class="headerlink" title="准备好四个文件"></a>准备好四个文件</h2><p><img src="/images/install/image-20191212095419550.png" alt="CentOS 7 安裝FastDFS"></p>
<p>下载地址：</p>
<p><a href="https://github.com/happyfish100" target="_blank" rel="noopener">https://github.com/happyfish100</a></p>
<h1 id="CentOS-7-FastDFS搭建"><a href="#CentOS-7-FastDFS搭建" class="headerlink" title="CentOS 7 FastDFS搭建"></a>CentOS 7 FastDFS搭建</h1><h2 id="安装libfastcommon"><a href="#安装libfastcommon" class="headerlink" title="安装libfastcommon"></a>安装libfastcommon</h2><p>上传到服务器,解压:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># unzip libfastcommon-master.zip</span></span><br></pre></td></tr></table></figure>

<p>进入libfastcommon-1.0.36目录:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># cd libfastcommon-master/</span></span><br><span class="line">[root@localhost libfastcommon-master]<span class="comment"># ll</span></span><br><span class="line">total 32</span><br><span class="line">drwxr-xr-x. 2 root root   114 Dec  6 11:49 doc</span><br><span class="line">-rw-r--r--. 1 root root 10179 Dec  6 11:49 HISTORY</span><br><span class="line">-rw-r--r--. 1 root root   674 Dec  6 11:49 INSTALL</span><br><span class="line">-rw-r--r--. 1 root root  1607 Dec  6 11:49 libfastcommon.spec</span><br><span class="line">-rwxr-xr-x. 1 root root  3253 Dec  6 11:49 make.sh</span><br><span class="line">drwxr-xr-x. 2 root root   191 Dec  6 11:49 php-fastcommon</span><br><span class="line">-rw-r--r--. 1 root root  2776 Dec  6 11:49 README</span><br><span class="line">drwxr-xr-x. 3 root root  4096 Dec  6 11:49 src</span><br><span class="line">[root@localhost libfastcommon-master]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>用yum安装gcc: </p>
<p>Yum命令相当好用，是RedHad和CentOS从指定服务器下载RPM包并自动安装。我个人比较喜欢。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost libfastcommon-master]<span class="comment"># yum -y install gcc-c++</span></span><br></pre></td></tr></table></figure>

<p>Complete! 执行完成了！</p>
<p>这个时候分别执行./make.sh和./make.sh install，正常情况是可以成功的。 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost libfastcommon-master]<span class="comment"># ./make.sh</span></span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o hash.o hash.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o chain.o chain.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o shared_func.o shared_func.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o ini_file_reader.o ini_file_reader.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o logger.o logger.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o sockopt.o sockopt.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o base64.o base64.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o sched_thread.o sched_thread.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o http_func.o http_func.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o md5.o md5.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o pthread_func.o pthread_func.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o local_ip_func.o local_ip_func.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o avl_tree.o avl_tree.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o ioevent.o ioevent.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o ioevent_loop.o ioevent_loop.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o fast_task_queue.o fast_task_queue.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o fast_timer.o fast_timer.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o process_ctrl.o process_ctrl.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o fast_mblock.o fast_mblock.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o connection_pool.o connection_pool.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o fast_mpool.o fast_mpool.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o fast_allocator.o fast_allocator.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o fast_buffer.o fast_buffer.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o multi_skiplist.o multi_skiplist.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o flat_skiplist.o flat_skiplist.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o system_info.o system_info.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o fast_blocked_queue.o fast_blocked_queue.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o id_generator.o id_generator.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o char_converter.o char_converter.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o char_convert_loader.o char_convert_loader.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o common_blocked_queue.o common_blocked_queue.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o multi_socket_client.o multi_socket_client.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o skiplist_set.o skiplist_set.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -o json_parser.o json_parser.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o hash.lo hash.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o chain.lo chain.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o shared_func.lo shared_func.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o ini_file_reader.lo ini_file_reader.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o logger.lo logger.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o sockopt.lo sockopt.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o base64.lo base64.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o sched_thread.lo sched_thread.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o http_func.lo http_func.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o md5.lo md5.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o pthread_func.lo pthread_func.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o local_ip_func.lo local_ip_func.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o avl_tree.lo avl_tree.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o ioevent.lo ioevent.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o ioevent_loop.lo ioevent_loop.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o fast_task_queue.lo fast_task_queue.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o fast_timer.lo fast_timer.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o process_ctrl.lo process_ctrl.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o fast_mblock.lo fast_mblock.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o connection_pool.lo connection_pool.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o fast_mpool.lo fast_mpool.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o fast_allocator.lo fast_allocator.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o fast_buffer.lo fast_buffer.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o multi_skiplist.lo multi_skiplist.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o flat_skiplist.lo flat_skiplist.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o system_info.lo system_info.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o fast_blocked_queue.lo fast_blocked_queue.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o id_generator.lo id_generator.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o char_converter.lo char_converter.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o char_convert_loader.lo char_convert_loader.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o common_blocked_queue.lo common_blocked_queue.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o multi_socket_client.lo multi_socket_client.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o skiplist_set.lo skiplist_set.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -c -fPIC -o json_parser.lo json_parser.c  </span><br><span class="line">cc -Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -g -O3 -o libfastcommon.so -shared hash.lo chain.lo shared_func.lo ini_file_reader.lo logger.lo sockopt.lo base64.lo sched_thread.lo http_func.lo md5.lo pthread_func.lo local_ip_func.lo avl_tree.lo ioevent.lo ioevent_loop.lo fast_task_queue.lo fast_timer.lo process_ctrl.lo fast_mblock.lo connection_pool.lo fast_mpool.lo fast_allocator.lo fast_buffer.lo multi_skiplist.lo flat_skiplist.lo system_info.lo fast_blocked_queue.lo id_generator.lo char_converter.lo char_convert_loader.lo common_blocked_queue.lo multi_socket_client.lo skiplist_set.lo json_parser.lo -lm -ldl -lpthread</span><br><span class="line">ar rcs libfastcommon.a hash.o chain.o shared_func.o ini_file_reader.o logger.o sockopt.o base64.o sched_thread.o http_func.o md5.o pthread_func.o local_ip_func.o avl_tree.o ioevent.o ioevent_loop.o fast_task_queue.o fast_timer.o process_ctrl.o fast_mblock.o connection_pool.o fast_mpool.o fast_allocator.o fast_buffer.o multi_skiplist.o flat_skiplist.o system_info.o fast_blocked_queue.o id_generator.o char_converter.o char_convert_loader.o common_blocked_queue.o multi_socket_client.o skiplist_set.o json_parser.o</span><br><span class="line">[root@localhost libfastcommon-master]<span class="comment"># ./make.sh install</span></span><br><span class="line">mkdir -p /usr/lib64</span><br><span class="line">mkdir -p /usr/lib</span><br><span class="line">mkdir -p /usr/include/fastcommon</span><br><span class="line">install -m 755 libfastcommon.so /usr/lib64</span><br><span class="line">install -m 644 common_define.h hash.h chain.h logger.h base64.h shared_func.h pthread_func.h ini_file_reader.h _os_define.h sockopt.h sched_thread.h http_func.h md5.h local_ip_func.h avl_tree.h ioevent.h ioevent_loop.h fast_task_queue.h fast_timer.h process_ctrl.h fast_mblock.h connection_pool.h fast_mpool.h fast_allocator.h fast_buffer.h skiplist.h multi_skiplist.h flat_skiplist.h skiplist_common.h system_info.h fast_blocked_queue.h php7_ext_wrapper.h id_generator.h char_converter.h char_convert_loader.h common_blocked_queue.h multi_socket_client.h skiplist_set.h fc_list.h json_parser.h /usr/include/fastcommon</span><br><span class="line"><span class="keyword">if</span> [ ! -e /usr/lib/libfastcommon.so ]; <span class="keyword">then</span> ln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so; <span class="keyword">fi</span></span><br><span class="line">[root@localhost libfastcommon-master]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>libfastcommon默认会被安装到/usr/lib64/libfastcommon.so但是FastDFS的主程序却在/usr/local/lib目录下</p>
<p>这个时候我们就要建立一个软链接了，实际上也相当于windows上的快捷方式。</p>
<p>ln -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so</p>
<p>ln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so</p>
<p>ln -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.so</p>
<p>ln -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost libfastcommon-master]<span class="comment"># ln -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so</span></span><br><span class="line">[root@localhost libfastcommon-master]<span class="comment"># ln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so</span></span><br><span class="line">ln: failed to create symbolic link ‘/usr/lib/libfastcommon.so’: File exists</span><br><span class="line">[root@localhost libfastcommon-master]<span class="comment"># ln -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.so</span></span><br><span class="line">[root@localhost libfastcommon-master]<span class="comment"># ln -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so</span></span><br><span class="line">[root@localhost libfastcommon-master]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="安装FastDFS"><a href="#安装FastDFS" class="headerlink" title="安装FastDFS"></a>安装FastDFS</h2><p>解压FastDFS安装包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># unzip fastdfs-master.zip</span></span><br></pre></td></tr></table></figure>

<p>解压后看到：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># ll</span></span><br><span class="line">total 2144</span><br><span class="line">drwx------.  2 dev1 dev1      62 Apr 11  2018 dev1</span><br><span class="line">drwxr-xr-x. 12 root root    4096 Dec  8 10:17 fastdfs-master</span><br><span class="line">-rw-r--r--.  1 root root  905173 Dec 10 20:24 fastdfs-master.zip</span><br><span class="line">-rw-r--r--.  1 root root   22492 Dec 10 20:24 fastdfs-nginx-module-master.zip</span><br><span class="line">drwxr-xr-x.  5 root root     153 Dec 10 20:37 libfastcommon-master</span><br><span class="line">-rw-r--r--.  1 root root  218881 Dec 10 20:24 libfastcommon-master.zip</span><br><span class="line">-rw-r--r--.  1 root root 1037527 Dec 10 20:24 nginx-1.17.6.tar.gz</span><br></pre></td></tr></table></figure>

<p>进到刚解压的目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># cd fastdfs-master/</span></span><br><span class="line">[root@localhost fastdfs-master]<span class="comment"># ./make.sh</span></span><br><span class="line">[root@localhost fastdfs-master]<span class="comment"># ./make.sh install</span></span><br></pre></td></tr></table></figure>

<p>如果没有报错那么就成功了。安装log中会提示FastDFS安装到了/etc/fdfs目录下。</p>
<p>成功后查看安装目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs-master]<span class="comment"># cd /etc/fdfs/</span></span><br><span class="line">[root@localhost fdfs]<span class="comment"># ll</span></span><br><span class="line">total 28</span><br><span class="line">-rw-r--r--. 1 root root  1909 Dec 10 20:40 client.conf.sample</span><br><span class="line">-rw-r--r--. 1 root root 10246 Dec 10 20:40 storage.conf.sample</span><br><span class="line">-rw-r--r--. 1 root root   620 Dec 10 20:40 storage_ids.conf.sample</span><br><span class="line">-rw-r--r--. 1 root root  8128 Dec 10 20:40 tracker.conf.sample</span><br><span class="line">[root@localhost fdfs]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>我们需要把这三个示例文件复制一份，去掉.sample。</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fdfs]<span class="comment"># cp client.conf.sample client.conf</span></span><br><span class="line">[root@localhost fdfs]<span class="comment"># cp storage.conf.sample storage.conf</span></span><br><span class="line">[root@localhost fdfs]<span class="comment"># cp tracker.conf.sample tracker.conf</span></span><br><span class="line">[root@localhost fdfs]<span class="comment"># ll</span></span><br><span class="line">total 52</span><br><span class="line">-rw-r--r--. 1 root root  1909 Dec 10 20:40 client.conf</span><br><span class="line">-rw-r--r--. 1 root root  1909 Dec 10 20:40 client.conf.sample</span><br><span class="line">-rw-r--r--. 1 root root 10246 Dec 10 20:40 storage.conf</span><br><span class="line">-rw-r--r--. 1 root root 10246 Dec 10 20:40 storage.conf.sample</span><br><span class="line">-rw-r--r--. 1 root root   620 Dec 10 20:40 storage_ids.conf.sample</span><br><span class="line">-rw-r--r--. 1 root root  8128 Dec 10 20:40 tracker.conf</span><br><span class="line">-rw-r--r--. 1 root root  8128 Dec 10 20:40 tracker.conf.sample</span><br><span class="line">[root@localhost fdfs]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>FastDFS安装结束。</p>
<h2 id="安装tracker"><a href="#安装tracker" class="headerlink" title="安装tracker"></a>安装tracker</h2><h3 id="创建tracker工作目录"><a href="#创建tracker工作目录" class="headerlink" title="创建tracker工作目录"></a>创建tracker工作目录</h3><p>这个目录可以自定义，用来保存tracker的data和log </p>
<p>根据个人习惯，我创建了下面的目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mkdir /data</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cd /data/</span></span><br><span class="line">[root@localhost data]<span class="comment"># mkdir fastdfs</span></span><br><span class="line">[root@localhost data]<span class="comment"># cd fastdfs/</span></span><br><span class="line">[root@localhost fastdfs]<span class="comment"># mkdir fastdfs_tracker</span></span><br><span class="line">[root@localhost fastdfs]<span class="comment"># cd fastdfs_tracker/</span></span><br><span class="line">[root@localhost fastdfs_tracker]<span class="comment"># pwd</span></span><br><span class="line">/data/fastdfs/fastdfs_tracker</span><br><span class="line">[root@localhost fastdfs_tracker]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h3 id="配置tracker"><a href="#配置tracker" class="headerlink" title="配置tracker"></a>配置tracker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs-5.11]<span class="comment"># cd /etc/fdfs/</span></span><br><span class="line">[root@localhost fastdfs-5.11]<span class="comment"># vim tracker.conf</span></span><br><span class="line">[root@localhost fastdfs-5.11]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>最小化的CentOS7是没有安装vim的，可以把vim tracker.conf命令改成vi tracker.conf，也可以去下载一个vim</p>
<p>yum -y install vim </p>
<p>打开后重点关注下面4个配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">disabled = <span class="literal">false</span></span><br><span class="line">port=22122</span><br><span class="line">base_path=/data/fastdfs/fastdfs_tracker</span><br><span class="line">http.server_port=6666  <span class="comment"># 默认8080  9901</span></span><br></pre></td></tr></table></figure>

<h3 id="启动tracker"><a href="#启动tracker" class="headerlink" title="启动tracker"></a>启动tracker</h3><p>保存配置后启动tracker，命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service fdfs_trackerd start</span><br></pre></td></tr></table></figure>

<p>如果不能启动，或提示用systemctl可改用命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start fdfs_trackerd</span><br></pre></td></tr></table></figure>

<p>成功后应该可以看到：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fdfs]<span class="comment"># service fdfs_trackerd start</span></span><br><span class="line">Reloading systemd:                                         [  OK  ]</span><br><span class="line">Starting fdfs_trackerd (via systemctl):                    [  OK  ]</span><br><span class="line">[root@localhost fdfs]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>进行刚刚创建的tracker目录，发现目录中多了data和log两个目录</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fdfs]<span class="comment"># cd /data/fastdfs/fastdfs_tracker/</span></span><br><span class="line">[root@localhost fastdfs_tracker]<span class="comment"># ll</span></span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x. 2 root root 83 Dec 10 20:45 data</span><br><span class="line">drwxr-xr-x. 2 root root 26 Dec 10 20:44 logs</span><br><span class="line">[root@localhost fastdfs_tracker]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>最后我们需要给tracker加入开机启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs_tracker]<span class="comment"># ll /etc/rc.d/rc.local</span></span><br><span class="line">-rw-r--r--. 1 root root 473 Feb 20  2019 /etc/rc.d/rc.local</span><br><span class="line">[root@localhost fastdfs_tracker]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>发现并没有执行权限，需要加一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs_tracker]<span class="comment"># chmod +x /etc/rc.d/rc.local</span></span><br><span class="line">[root@localhost fastdfs_tracker]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>加完后应该是这样的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs_tracker]<span class="comment"># ll /etc/rc.d/rc.local      </span></span><br><span class="line">-rwxr-xr-x. 1 root root 473 Feb 20  2019 /etc/rc.d/rc.local</span><br><span class="line">[root@localhost fastdfs_tracker]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>修改rc.local</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs_tracker]<span class="comment"># vim /etc/rc.d/rc.local</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># It is highly advisable to create own systemd services or udev rules</span></span><br><span class="line"><span class="comment"># to run scripts during boot instead of using this file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># In contrast to previous versions due to parallel execution during boot</span></span><br><span class="line"><span class="comment"># this script will NOT be run after all other services.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure</span></span><br><span class="line"><span class="comment"># that this script will be executed during boot.</span></span><br><span class="line"></span><br><span class="line">touch /var/lock/subsys/<span class="built_in">local</span></span><br><span class="line">service fdfs_trackerd start</span><br></pre></td></tr></table></figure>

<p>查看一下tracker的端口监听情况</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs_tracker]<span class="comment"># netstat -unltp|grep fdfs</span></span><br><span class="line">tcp        0      0 0.0.0.0:22122           0.0.0.0:*               LISTEN      20553/fdfs_trackerd </span><br><span class="line">[root@localhost fastdfs_tracker]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>端口22122成功监听。</p>
<h2 id="安装storage"><a href="#安装storage" class="headerlink" title="安装storage"></a>安装storage</h2><p>storage的安装与tracker很类似。</p>
<h3 id="为storage配置工作目录"><a href="#为storage配置工作目录" class="headerlink" title="为storage配置工作目录"></a>为storage配置工作目录</h3><p>与tracker不现的是，由于storage还需要一个目录用来存储数据，所以我另外多建了一个fasdfs_storage_data </p>
<p>下面是我的目录结构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs]<span class="comment"># cd /data/fastdfs</span></span><br><span class="line">[root@localhost fastdfs]<span class="comment"># mkdir fastdfs_storage</span></span><br><span class="line">[root@localhost fastdfs]<span class="comment"># mkdir fastdfs_storage_data</span></span><br><span class="line">[root@localhost fastdfs]<span class="comment"># ll</span></span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x. 2 root root  6 Dec 10 20:43 fastdfs_storage</span><br><span class="line">drwxr-xr-x. 2 root root  6 Dec 10 20:43 fastdfs_storage_data</span><br><span class="line">drwxr-xr-x. 4 root root 30 Dec 10 20:42 fastdfs_tracker</span><br><span class="line">[root@localhost fastdfs]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h3 id="修改storage配置文件"><a href="#修改storage配置文件" class="headerlink" title="修改storage配置文件"></a>修改storage配置文件</h3><p>修改storage.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs]<span class="comment"># vim /etc/fdfs/storage.conf</span></span><br><span class="line">disabled=<span class="literal">false</span> </span><br><span class="line">group_name=group1 <span class="comment">#组名，根据实际情况修改 </span></span><br><span class="line">port=23000 <span class="comment">#设置storage的端口号，默认是23000，同一个组的storage端口号必须一致 </span></span><br><span class="line">base_path=/data/fastdfs/fastdfs_storage <span class="comment">#设置storage数据文件和日志目录 </span></span><br><span class="line">store_path_count=1 <span class="comment">#存储路径个数，需要和store_path个数匹配 </span></span><br><span class="line"></span><br><span class="line">》》》》》store_path0=/data/fastdfs/fastdfs_storage_data <span class="comment">#实际文件存储路径 </span></span><br><span class="line">》》》》》base_path0=/data/fastdfs/fastdfs_storage_data <span class="comment">#实际文件存储路径 </span></span><br><span class="line">tracker_server=192.168.31.100:22122 <span class="comment">#我CentOS7的ip地址 </span></span><br><span class="line">http.server_port=8888 <span class="comment">#设置 http 端口号</span></span><br><span class="line"></span><br><span class="line">[root@localhost fastdfs]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>修改保存后创建软引用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs]<span class="comment"># ln -s /usr/bin/fdfs_storaged /usr/local/bin</span></span><br><span class="line">[root@localhost fastdfs]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h3 id="启动storage"><a href="#启动storage" class="headerlink" title="启动storage"></a>启动storage</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service fdfs_storaged start</span><br></pre></td></tr></table></figure>

<p>如果不能启动，或提示用systemctl可改用命令：</p>
<p>systemctl start fdfs_storaged</p>
<p>成功后应该可以看到：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs]<span class="comment"># service fdfs_storaged start</span></span><br><span class="line">Starting fdfs_storaged (via systemctl):                    [  OK  ]</span><br><span class="line">[root@localhost fastdfs]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>同样的，设置开机启动： </p>
<p>修改rc.local</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># It is highly advisable to create own systemd services or udev rules</span></span><br><span class="line"><span class="comment"># to run scripts during boot instead of using this file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># In contrast to previous versions due to parallel execution during boot</span></span><br><span class="line"><span class="comment"># this script will NOT be run after all other services.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure</span></span><br><span class="line"><span class="comment"># that this script will be executed during boot.</span></span><br><span class="line"></span><br><span class="line">touch /var/lock/subsys/<span class="built_in">local</span></span><br><span class="line">service fdfs_trackerd start</span><br><span class="line">service fdfs_storaged start</span><br></pre></td></tr></table></figure>

<p>查看一下服务是否启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs]<span class="comment"># netstat -unltp | grep fdfs</span></span><br><span class="line">tcp        0      0 0.0.0.0:22122           0.0.0.0:*               LISTEN      20553/fdfs_trackerd </span><br><span class="line">tcp        0      0 0.0.0.0:23000           0.0.0.0:*               LISTEN      20817/fdfs_storaged </span><br><span class="line">[root@localhost fastdfs]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="校验整合"><a href="#校验整合" class="headerlink" title="校验整合"></a>校验整合</h2><p>到这里，fastdfs的东西都已安装完成，最后我们还要确定一下，storage是否注册到了tracker中去。</p>
<p>查看命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs]<span class="comment"># /usr/bin/fdfs_monitor /etc/fdfs/storage.conf</span></span><br><span class="line">[2019-12-10 21:04:31] DEBUG - base_path=/data/fastdfs/fastdfs_storage, connect_timeout=5, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=1, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0</span><br><span class="line"></span><br><span class="line">server_count=1, server_index=0</span><br><span class="line"></span><br><span class="line">tracker server is 192.168.31.100:22122</span><br><span class="line"></span><br><span class="line">group count: 1</span><br><span class="line"></span><br><span class="line">Group 1:</span><br><span class="line">group name = group1</span><br><span class="line">disk total space = 51175 MB</span><br><span class="line">disk free space = 48527 MB</span><br><span class="line">trunk free space = 0 MB</span><br><span class="line">storage server count = 1</span><br><span class="line">active server count = 1</span><br><span class="line">storage server port = 23000</span><br><span class="line">storage HTTP port = 8888</span><br><span class="line">store path count = 1</span><br><span class="line">subdir count per path = 256</span><br><span class="line">current write server index = 0</span><br><span class="line">current trunk file id = 0</span><br><span class="line"></span><br><span class="line">        Storage 1:</span><br><span class="line">                id = 10.254.193.118</span><br><span class="line">                ip_addr = 10.254.193.118 (anantes-651-1-49-net.w2-0.abo.wanadoo.fr)  ACTIVE</span><br><span class="line">                http domain = </span><br><span class="line">                version = 6.04</span><br><span class="line">                join time = 2019-12-10 21:01:47</span><br><span class="line">                up time = 2019-12-10 21:01:47</span><br><span class="line">                total storage = 51175 MB</span><br><span class="line">                free storage = 48527 MB</span><br><span class="line">                upload priority = 10</span><br><span class="line">                store_path_count = 1</span><br><span class="line">                subdir_count_per_path = 256</span><br><span class="line">                storage_port = 23000</span><br><span class="line">                storage_http_port = 8888</span><br><span class="line">                current_write_path = 0</span><br><span class="line">                <span class="built_in">source</span> storage id = </span><br><span class="line">                if_trunk_server = 0</span><br><span class="line">                connection.alloc_count = 256</span><br><span class="line">                connection.current_count = 0</span><br><span class="line">                connection.max_count = 0</span><br><span class="line">                total_upload_count = 0</span><br><span class="line">                success_upload_count = 0</span><br><span class="line">                total_append_count = 0</span><br><span class="line">                success_append_count = 0</span><br><span class="line">                total_modify_count = 0</span><br><span class="line">                success_modify_count = 0</span><br><span class="line">                total_truncate_count = 0</span><br><span class="line">                success_truncate_count = 0</span><br><span class="line">                total_set_meta_count = 0</span><br><span class="line">                success_set_meta_count = 0</span><br><span class="line">                total_delete_count = 0</span><br><span class="line">                success_delete_count = 0</span><br><span class="line">                total_download_count = 0</span><br><span class="line">                success_download_count = 0</span><br><span class="line">                total_get_meta_count = 0</span><br><span class="line">                success_get_meta_count = 0</span><br><span class="line">                total_create_link_count = 0</span><br><span class="line">                success_create_link_count = 0</span><br><span class="line">                total_delete_link_count = 0</span><br><span class="line">                success_delete_link_count = 0</span><br><span class="line">                total_upload_bytes = 0</span><br><span class="line">                success_upload_bytes = 0</span><br><span class="line">                total_append_bytes = 0</span><br><span class="line">                success_append_bytes = 0</span><br><span class="line">                total_modify_bytes = 0</span><br><span class="line">                success_modify_bytes = 0</span><br><span class="line">                stotal_download_bytes = 0</span><br><span class="line">                success_download_bytes = 0</span><br><span class="line">                total_sync_in_bytes = 0</span><br><span class="line">                success_sync_in_bytes = 0</span><br><span class="line">                total_sync_out_bytes = 0</span><br><span class="line">                success_sync_out_bytes = 0</span><br><span class="line">                total_file_open_count = 0</span><br><span class="line">                success_file_open_count = 0</span><br><span class="line">                total_file_read_count = 0</span><br><span class="line">                success_file_read_count = 0</span><br><span class="line">                total_file_write_count = 0</span><br><span class="line">                success_file_write_count = 0</span><br><span class="line">                last_heart_beat_time = 2019-12-10 21:04:20</span><br><span class="line">                last_source_update = 1970-01-01 08:00:00</span><br><span class="line">                last_sync_update = 1970-01-01 08:00:00</span><br><span class="line">                last_synced_timestamp = 1970-01-01 08:00:00 </span><br><span class="line">[root@localhost fastdfs]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><p>前面已对FastDFS的安装和配置，做了比较详细的讲解。FastDFS的基础模块都搭好了，现在开始测试下载。</p>
<h2 id="配置客户端"><a href="#配置客户端" class="headerlink" title="配置客户端"></a>配置客户端</h2><p>同样的，需要修改客户端的配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs]<span class="comment"># vim /etc/fdfs/client.conf</span></span><br><span class="line">base_path = /data/fastdfs/fastdfs_tracker</span><br><span class="line">tracker_server = 192.168.31.100:22122</span><br><span class="line">http.tracker_server_port = 6666   <span class="comment"># 默认端口80</span></span><br></pre></td></tr></table></figure>



<p>通过ftp上传图片到CentOS:</p>
<p>在我的windows上，我随便拖了一张图片上去。</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs]<span class="comment"># cd /home/</span></span><br><span class="line">[root@localhost home]<span class="comment"># ll</span></span><br><span class="line">total 1148</span><br><span class="line">-rw-r--r--.  1 root root  18832 Oct 12 12:58 123.png</span><br><span class="line">drwx------.  2 dev1 dev1     62 Apr 11  2018 dev1</span><br><span class="line">drwxr-xr-x. 12 root root   4096 Dec  8 10:17 fastdfs-5.11</span><br><span class="line">-rw-r--r--.  1 root root 905173 Dec 10 11:38 fastdfs-5.11.zip</span><br><span class="line">-rw-r--r--.  1 root root  22492 Dec 10 11:38 fastdfs-nginx-module-master.zip</span><br><span class="line">drwxr-xr-x.  5 root root    153 Dec 10 19:48 libfastcommon-1.0.36</span><br><span class="line">-rw-r--r--.  1 root root 218881 Dec 10 11:36 libfastcommon-1.0.36.zip</span><br><span class="line">[root@localhost home]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="模拟上传"><a href="#模拟上传" class="headerlink" title="模拟上传"></a>模拟上传</h2><p>确定图片位置后，我们输入上传图片命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># /usr/bin/fdfs_upload_file /etc/fdfs/client.conf /home/123.jpg </span></span><br><span class="line">group1/M00/00/00/wKgfZF3vl6WAJDW5AAvWFlS1kOw230.jpg</span><br><span class="line">[root@localhost home]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>成功后会返回图片的路径：</p>
<p>[root@localhost~]# /usr/bin/fdfs_upload_file /etc/fdfs/client.conf /home/123.png</p>
<p>group1/M00/00/00/wKgfZF3vl6WAJDW5AAvWFlS1kOw230.jpg</p>
<p>组名：group1 </p>
<p>磁盘：M00 </p>
<p>目录：00/00 </p>
<p>文件名称：wKgfZF3vl6WAJDW5AAvWFlS1kOw230.png</p>
<p>我们上传的图片会被上传到我们创建的storage_data目录下，让我们去看看：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs_storage_data]<span class="comment"># cd /data/fastdfs/fastdfs_storage_data/data/</span></span><br><span class="line">[root@localhost data]<span class="comment"># ls</span></span><br><span class="line">00  06  0C  12  18  1E  24  2A  30  36  3C  42  48  4E  54  5A  60  66  6C  72  78  7E  84  8A  90  96  9C  A2  A8  AE  B4  BA  C0  C6  CC  D2  D8  DE  E4  EA  F0  F6  FC</span><br><span class="line">01  07  0D  13  19  1F  25  2B  31  37  3D  43  49  4F  55  5B  61  67  6D  73  79  7F  85  8B  91  97  9D  A3  A9  AF  B5  BB  C1  C7  CD  D3  D9  DF  E5  EB  F1  F7  FD</span><br><span class="line">02  08  0E  14  1A  20  26  2C  32  38  3E  44  4A  50  56  5C  62  68  6E  74  7A  80  86  8C  92  98  9E  A4  AA  B0  B6  BC  C2  C8  CE  D4  DA  E0  E6  EC  F2  F8  FE</span><br><span class="line">03  09  0F  15  1B  21  27  2D  33  39  3F  45  4B  51  57  5D  63  69  6F  75  7B  81  87  8D  93  99  9F  A5  AB  B1  B7  BD  C3  C9  CF  D5  DB  E1  E7  ED  F3  F9  FF</span><br><span class="line">04  0A  10  16  1C  22  28  2E  34  3A  40  46  4C  52  58  5E  64  6A  70  76  7C  82  88  8E  94  9A  A0  A6  AC  B2  B8  BE  C4  CA  D0  D6  DC  E2  E8  EE  F4  FA</span><br><span class="line">05  0B  11  17  1D  23  29  2F  35  3B  41  47  4D  53  59  5F  65  6B  71  77  7D  83  89  8F  95  9B  A1  A7  AD  B3  B9  BF  C5  CB  D1  D7  DD  E3  E9  EF  F5  FB</span><br><span class="line">[root@localhost data]<span class="comment"># cd 00/</span></span><br><span class="line">[root@localhost 00]<span class="comment"># ls</span></span><br><span class="line">00  06  0C  12  18  1E  24  2A  30  36  3C  42  48  4E  54  5A  60  66  6C  72  78  7E  84  8A  90  96  9C  A2  A8  AE  B4  BA  C0  C6  CC  D2  D8  DE  E4  EA  F0  F6  FC</span><br><span class="line">01  07  0D  13  19  1F  25  2B  31  37  3D  43  49  4F  55  5B  61  67  6D  73  79  7F  85  8B  91  97  9D  A3  A9  AF  B5  BB  C1  C7  CD  D3  D9  DF  E5  EB  F1  F7  FD</span><br><span class="line">02  08  0E  14  1A  20  26  2C  32  38  3E  44  4A  50  56  5C  62  68  6E  74  7A  80  86  8C  92  98  9E  A4  AA  B0  B6  BC  C2  C8  CE  D4  DA  E0  E6  EC  F2  F8  FE</span><br><span class="line">03  09  0F  15  1B  21  27  2D  33  39  3F  45  4B  51  57  5D  63  69  6F  75  7B  81  87  8D  93  99  9F  A5  AB  B1  B7  BD  C3  C9  CF  D5  DB  E1  E7  ED  F3  F9  FF</span><br><span class="line">04  0A  10  16  1C  22  28  2E  34  3A  40  46  4C  52  58  5E  64  6A  70  76  7C  82  88  8E  94  9A  A0  A6  AC  B2  B8  BE  C4  CA  D0  D6  DC  E2  E8  EE  F4  FA</span><br><span class="line">05  0B  11  17  1D  23  29  2F  35  3B  41  47  4D  53  59  5F  65  6B  71  77  7D  83  89  8F  95  9B  A1  A7  AD  B3  B9  BF  C5  CB  D1  D7  DD  E3  E9  EF  F5  FB</span><br><span class="line">[root@localhost 00]<span class="comment"># cd 00</span></span><br><span class="line">[root@localhost 00]<span class="comment"># ls</span></span><br><span class="line">wKgfZF3vl6WAJDW5AAvWFlS1kOw230.png</span><br><span class="line">[root@localhost 00]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>果然通过刚刚返回的路径，我们成功找到了图片。</p>
<p>我们仔细看一下，实际文件存储路径下有创建好的多级目录。data下有256个1级目录，每级目录下又有256个2级子目录，总共65536个文件，新写的文件会以hash的方式被路由到其中某个子目录下，然后将文件数据直接作为一个本地文件存储到该目录中。</p>
<h2 id="HTTP访问文件"><a href="#HTTP访问文件" class="headerlink" title="HTTP访问文件"></a>HTTP访问文件</h2><p>我们去浏览器用http请求访问一下刚刚的图片：</p>
<p>这里写图片描述</p>
<p>我们发现，http不能直接访问到图片。这是为什么呢。</p>
<p>我去官网看了一原码，在HISTORY中发现，原来早在4.05的时候，就remove embed HTTP support</p>
<p>Version 4.05 2012-12-30</p>
<p> * client/fdfs_upload_file.c can specify storage ip port and store path index</p>
<p> * add connection pool</p>
<p> * client load storage ids config</p>
<p> * common/ini_file_reader.c does NOT call chdir</p>
<p> * keep the mtime of file same</p>
<p> * use g_current_time instead of call time function</p>
<p> * remove embed HTTP support</p>
<h2 id="HTTP请求不能访问文件的原因"><a href="#HTTP请求不能访问文件的原因" class="headerlink" title="HTTP请求不能访问文件的原因"></a>HTTP请求不能访问文件的原因</h2><p>我们在使用FastDFS部署一个分布式文件系统的时候，通过FastDFS的客户端API来进行文件的上传、下载、删除等操作。同时通过FastDFS的HTTP服务器来提供HTTP服务。但是FastDFS的HTTP服务较为简单，无法提供负载均衡等高性能的服务，所以FastDFS的开发者——淘宝的架构师余庆同学，为我们提供了Nginx上使用的FastDFS模块（也可以叫FastDFS的Nginx模块）。</p>
<p>FastDFS通过Tracker服务器,将文件放在Storage服务器存储,但是同组之间的服务器需要复制文件,有延迟的问题.假设Tracker服务器将文件上传到了192.168.128.131,文件ID已经返回客户端,这时,后台会将这个文件复制到192.168.128.131,如果复制没有完成,客户端就用这个ID在192.168.128.131取文件,肯定会出现错误。这个fastdfs-nginx-module可以重定向连接到源服务器取文件,避免客户端由于复制延迟的问题,出现错误。 </p>
<p>正是这样，FastDFS需要结合nginx，所以取消原来对HTTP的直接支持。</p>
<h1 id="FastDFS的nginx模块安装"><a href="#FastDFS的nginx模块安装" class="headerlink" title="FastDFS的nginx模块安装"></a>FastDFS的nginx模块安装</h1><h2 id="安装nginx准备"><a href="#安装nginx准备" class="headerlink" title="安装nginx准备"></a>安装nginx准备</h2><p>将nginx-1.17.6.tar.gz上传至linux</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost 00]# cd /home/</span><br><span class="line">[root@lml74xunyuanfuwuqi home]# ll</span><br><span class="line">总用量 2164</span><br><span class="line">-rw-r--r--  1 root root   18832 10月 12 12:58 123.png</span><br><span class="line">drwx------  2 dceq dceq      62 11月 15 18:14 dceq</span><br><span class="line">drwxr-xr-x 12 root root    4096 12月  8 10:17 fastdfs-master</span><br><span class="line">-rw-r--r--  1 root root  905173 12月 10 11:38 fastdfs-master.zip</span><br><span class="line">-rw-r--r--  1 root root   22492 12月 10 11:38 fastdfs-nginx-module-master.zip</span><br><span class="line">drwxr-xr-x  5 root root     153 12月 11 15:07 libfastcommon-master</span><br><span class="line">-rw-r--r--  1 root root  218881 12月 10 11:36 libfastcommon-master.zip</span><br><span class="line">-rw-r--r--  1 root root 1037527 12月 10 13:38 nginx-1.17.6.tar.gz</span><br><span class="line">drwxr-xr-x  3 root root      21 12月 11 09:03 work</span><br><span class="line">[root@localhost home]#</span><br></pre></td></tr></table></figure>

<p>在安装nginx之前要安装nginx所需的依赖lib:</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># yum -y install pcre pcre-devel </span></span><br><span class="line">[root@localhost home]<span class="comment"># yum -y install zlib zlib-devel</span></span><br><span class="line">[root@localhost home]<span class="comment"># yum -y install openssl openssl-devel</span></span><br></pre></td></tr></table></figure>

<h2 id="安装nginx并添加fastdfs-nginx-module"><a href="#安装nginx并添加fastdfs-nginx-module" class="headerlink" title="安装nginx并添加fastdfs-nginx-module"></a>安装nginx并添加fastdfs-nginx-module</h2><p>解压nginx,和fastdfs-nginx-module:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># tar -zxvf nginx-1.17.6.tar.gz </span></span><br><span class="line">[root@localhost home]<span class="comment"># unzip fastdfs-nginx-module-master.zip</span></span><br></pre></td></tr></table></figure>

<p>解压后进入nginx目录编译安装nginx,并添加fastdfs-nginx-module：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@lml74xunyuanfuwuqi home]# cd nginx-1.17.6</span><br><span class="line">[root@localhost nginx-1.17.6]# ./configure --prefix=/usr/local/nginx --add-module=/home/fastdfs-nginx-module-master/src</span><br><span class="line"></span><br><span class="line">#解压后fastdfs-nginx-module所在的位置</span><br></pre></td></tr></table></figure>

<p>如果配置不报错的话，就开始编译：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost nginx-1.17.6]<span class="comment"># make</span></span><br><span class="line">[root@localhost nginx-1.17.6]<span class="comment"># make install</span></span><br></pre></td></tr></table></figure>

<p>如果报错的话，很可能是版本的原因，在我的第二篇博文中提供了我测试成功不报错的版本下载。</p>
<p>nginx的默认目录是/usr/local/nginx，安装成功后查看：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost nginx-1.17.6]<span class="comment"># cd /usr/local/nginx/</span></span><br><span class="line">[root@localhost nginx]<span class="comment"># ll</span></span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Dec 10 21:06 conf</span><br><span class="line">drwxr-xr-x. 2 root root   40 Dec 10 21:06 html</span><br><span class="line">drwxr-xr-x. 2 root root    6 Dec 10 21:06 logs</span><br><span class="line">drwxr-xr-x. 2 root root   19 Dec 10 21:06 sbin</span><br><span class="line">[root@lml74xunyuanfuwuqi nginx]<span class="comment"># cd conf/</span></span><br><span class="line">[root@localhost nginx]<span class="comment"># </span></span><br><span class="line">[root@lml74xunyuanfuwuqi conf]<span class="comment"># vi nginx.conf</span></span><br></pre></td></tr></table></figure>

<h2 id="配置storage-nginx"><a href="#配置storage-nginx" class="headerlink" title="配置storage nginx"></a>配置storage nginx</h2><p>修改nginx.conf:</p>
<p>修改监听端口 listen 9999， 新增location</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost nginx]# cd conf/</span><br><span class="line">[root@localhost conf]# ll</span><br><span class="line">total 68</span><br><span class="line">-rw-r--r--. 1 root root 1077 Dec 10 21:06 fastcgi.conf</span><br><span class="line">-rw-r--r--. 1 root root 1077 Dec 10 21:06 fastcgi.conf.default</span><br><span class="line">-rw-r--r--. 1 root root 1007 Dec 10 21:06 fastcgi_params</span><br><span class="line">-rw-r--r--. 1 root root 1007 Dec 10 21:06 fastcgi_params.default</span><br><span class="line">-rw-r--r--. 1 root root 2837 Dec 10 21:06 koi-utf</span><br><span class="line">-rw-r--r--. 1 root root 2223 Dec 10 21:06 koi-win</span><br><span class="line">-rw-r--r--. 1 root root 5231 Dec 10 21:06 mime.types</span><br><span class="line">-rw-r--r--. 1 root root 5231 Dec 10 21:06 mime.types.default</span><br><span class="line">-rw-r--r--. 1 root root 2656 Dec 10 21:06 nginx.conf</span><br><span class="line">-rw-r--r--. 1 root root 2656 Dec 10 21:06 nginx.conf.default</span><br><span class="line">-rw-r--r--. 1 root root  636 Dec 10 21:06 scgi_params</span><br><span class="line">-rw-r--r--. 1 root root  636 Dec 10 21:06 scgi_params.default</span><br><span class="line">-rw-r--r--. 1 root root  664 Dec 10 21:06 uwsgi_params</span><br><span class="line">-rw-r--r--. 1 root root  664 Dec 10 21:06 uwsgi_params.default</span><br><span class="line">-rw-r--r--. 1 root root 3610 Dec 10 21:06 win-utf</span><br><span class="line">[root@localhost conf]# vi nginx.conf</span><br><span class="line"></span><br><span class="line">#user  nobody;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">    #                  &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">    #                  &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       9999;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        location ~/group1/M00 &#123;</span><br><span class="line">            root /data/fastdfs/fastdfs_storage_data/data;</span><br><span class="line">            ngx_fastdfs_module;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    proxy_pass   http://127.0.0.1;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # deny access to .htaccess files, if Apache&apos;s document root</span><br><span class="line">        # concurs with nginx&apos;s one</span><br><span class="line">        #</span><br><span class="line">        #location ~ /\.ht &#123;</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       8000;</span><br><span class="line">    #    listen       somename:8080;</span><br><span class="line">    #    server_name  somename  alias  another.alias;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       443 ssl;</span><br><span class="line">    #    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #    ssl_certificate      cert.pem;</span><br><span class="line">    #    ssl_certificate_key  cert.key;</span><br><span class="line"></span><br><span class="line">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    #    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    #    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">[root@localhost conf]# </span><br><span class="line">[root@localhost conf]#</span><br></pre></td></tr></table></figure>

<p>然后进入FastDFS安装时的解压过的目录，将http.conf和mime.types拷贝到/etc/fdfs目录下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost conf]<span class="comment"># cd /home/fastdfs-master/conf/</span></span><br><span class="line">[root@localhost conf]<span class="comment"># ll</span></span><br><span class="line">total 88</span><br><span class="line">-rw-r--r--. 1 root root 23981 Dec  8 10:17 anti-steal.jpg</span><br><span class="line">-rw-r--r--. 1 root root  1909 Dec  8 10:17 client.conf</span><br><span class="line">-rw-r--r--. 1 root root   965 Dec  8 10:17 http.conf</span><br><span class="line">-rw-r--r--. 1 root root 31172 Dec  8 10:17 mime.types</span><br><span class="line">-rw-r--r--. 1 root root 10246 Dec  8 10:17 storage.conf</span><br><span class="line">-rw-r--r--. 1 root root   620 Dec  8 10:17 storage_ids.conf</span><br><span class="line">-rw-r--r--. 1 root root  8128 Dec  8 10:17 tracker.conf</span><br><span class="line">[root@localhost conf]<span class="comment"># </span></span><br><span class="line">[root@localhost conf]<span class="comment"># cp http.conf /etc/fdfs/</span></span><br><span class="line">[root@localhost conf]<span class="comment"># cp mime.types /etc/fdfs/</span></span><br><span class="line">[root@localhost conf]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>另外还需要把fastdfs-nginx-module安装目录中src目录下的mod_fastdfs.conf也拷贝到/etc/fdfs目录下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost conf]<span class="comment"># cp /home/fastdfs-nginx-module-master/src/mod_fastdfs.conf /etc/fdfs/</span></span><br><span class="line">[root@localhost conf]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>对刚刚拷贝的mod_fastdfs.conf文件进行修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost conf]# vim /etc/fdfs/mod_fastdfs.conf</span><br><span class="line">! base_path=/data/fastdfs/fastdfs_storage  #保存日志目录</span><br><span class="line">! tracker_server=192.168.31.100:22122 #tracker服务器的IP地址以及端口号</span><br><span class="line">! storage_server_port=23000 #storage服务器的端口号</span><br><span class="line">! url_have_group_name = true #文件 url 中是否有 group 名</span><br><span class="line">! store_path0=/data/fastdfs/fastdfs_storage_data   #存储路径</span><br><span class="line">group_count = 3 #设置组的个数，事实上这次只使用了group1</span><br><span class="line">在文件的最后，设置group</span><br><span class="line"></span><br><span class="line">[group1]</span><br><span class="line">group_name=group1</span><br><span class="line">storage_server_port=23000</span><br><span class="line">store_path_count=1</span><br><span class="line">store_path0=/data/fastdfs/fastdfs_storage_data</span><br><span class="line">store_path1=/data/fastdfs/fastdfs_storage_data</span><br><span class="line"></span><br><span class="line"># group settings for group #2</span><br><span class="line"># # since v1.14</span><br><span class="line"># # when support multi-group, uncomment following section as neccessary</span><br><span class="line">[group2]</span><br><span class="line">group_name=group2</span><br><span class="line">storage_server_port=23000</span><br><span class="line">store_path_count=1</span><br><span class="line">store_path0=/data/fastdfs/fastdfs_storage_data</span><br><span class="line"></span><br><span class="line">[group3]</span><br><span class="line">group_name=group3</span><br><span class="line">storage_server_port=23000</span><br><span class="line">store_path_count=1</span><br><span class="line">store_path0=/data/fastdfs/fastdfs_storage_data</span><br><span class="line"></span><br><span class="line">[root@localhost conf]#</span><br></pre></td></tr></table></figure>

<p>创建M00至storage存储目录的符号连接：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost conf]<span class="comment"># ln -s /data/fastdfs/fastdfs_storage_data/data/ /data/fastdfs/fastdfs_storage_data/data/M00</span></span><br><span class="line">[root@localhost conf]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>启动nginx:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost conf]<span class="comment"># /usr/local/nginx/sbin/nginx </span></span><br><span class="line">ngx_http_fastdfs_set pid=31687</span><br><span class="line">[root@localhost conf]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>成功启动：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost conf]<span class="comment"># /usr/local/nginx/sbin/nginx </span></span><br><span class="line">ngx_http_fastdfs_set pid=31687</span><br><span class="line">[root@localhost conf]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/install/image-20191210173359098.png" alt="CentOS 7 安裝FastDFS"></p>
<p>恭喜你，storage的nginx已配置成功。接下来，我们还要继续配置tracker的nginx。</p>
<h2 id="配置tracker-nginx"><a href="#配置tracker-nginx" class="headerlink" title="配置tracker nginx"></a>配置tracker nginx</h2><p>再解压一个nginx： </p>
<p>我在我自己的工作下再建了一个nginx2，把原来的nginx-1.12.0.tar.gz又解压了一份到里面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]# mkdir nginx2</span><br><span class="line">[root@localhost home]# tar -zxvf nginx-1.17.6.tar.gz -C nginx2/</span><br><span class="line">[root@localhost home]# cd nginx2/nginx-1.17.6/</span><br><span class="line">[root@localhost nginx-1.17.6]# ./configure --prefix=/usr/local/nginx2 --add-module=/home/fastdfs-nginx-module-master/src</span><br><span class="line">[root@localhost nginx-1.17.6]# make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>接下来，一样的还是修改nginx.conf，端口号可以不改，用80的。需将upstream指向tracker的nginx地址。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost nginx-1.17.6]# vim /usr/local/nginx2/conf/nginx.conf</span><br><span class="line"></span><br><span class="line"> 	upstream fdfs_group1 &#123;</span><br><span class="line">        server 127.0.0.1:9999;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location /group1/M00 &#123;</span><br><span class="line">            proxy_pass http://fdfs_group1;</span><br><span class="line">        &#125;</span><br><span class="line">        #location / &#123;</span><br><span class="line">        #    root   html;</span><br><span class="line">        #    index  index.html index.htm;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>启动nginx2:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost nginx-1.17.6]# /usr/local/nginx2/sbin/nginx</span><br></pre></td></tr></table></figure>

<p><img src="/images/install/image-20191210174632271.png" alt="CentOS 7 安裝FastDFS"></p>
<p>可以成功访问。</p>
<p>防火墙端口设置<br>成功了，为什么还要讲这个呢。因为有些同学到这里，还是不到访问，很可能是防火墙没有开启相应的端口。防火墙这个东西我建议大家还是不要关闭，虽然麻烦了一点。</p>
<p>查看已开启的端口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost nginx-1.13.8]# firewall-cmd --zone=public --list-ports</span><br><span class="line">20880/tcp 80/tcp 2181/tcp 23000/tcp 22122/tcp 9999/tcp</span><br><span class="line">[root@localhost nginx-1.13.8]#</span><br></pre></td></tr></table></figure>

<p>在我的CentOS上这些端口都是开放的。<br>storage:20880<br>tracker:23000<br>这两个端口要开启，到时候下一篇讲fastdfs-client-javas可能会造成无法连接。<br>9999和80端口是提供给nginx访问的。<br>开放端口号命令：–permanent表示永久生效，不加的话，重启后不生效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=23000/tcp --permanent #开户端口号</span><br></pre></td></tr></table></figure>

<p>CentOS7 防火墙相关命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable firewalld.service    #开启防火墙</span><br><span class="line">systemctl stop firewalld.service     #关闭防火墙(开机会仍会启动)</span><br><span class="line">systemctl disable firewalld.service  #禁用防火墙(开机后不再启动)</span><br></pre></td></tr></table></figure>

<h2 id="HTTP测试"><a href="#HTTP测试" class="headerlink" title="HTTP测试"></a>HTTP测试</h2><p>现在我们再去访问一下，原来我们上传过的文件：</p>
<p><img src="/images/install/image-20191210175045900.png" alt="CentOS 7 安裝FastDFS"></p>
<p>这个时候已经能成功访问。</p>

        <h2>相关文章</h2><ul><li><a href="/springboot/springboot-fastdfs/">SpringBoot2.x整合FastDFS</a></li></ul>
    </div>
    
        <div class="reward" ontouchstart>
    <div class="reward-wrap">赏
        <div class="reward-box">
            
            
                <span class="reward-type">
                    <img class="wechat" src="/images/weixin.png"><b>微信打赏</b>
                </span>
            
        </div>
    </div>
    <p class="reward-tip">赞赏是不耍流氓的鼓励</p>
</div>


    


    
        <div class="post-footer">
            <div class="col-sm-10">
                <div>
                    <b>本文链接</b>：<a href="/install/install-fastDFS-v6.0.3/" target="_blank">CentOS 7 安裝FastDFS V6.0.3</a>
                </div>
                <div>
                    
                        转载声明：本博客由小小冒险家创作，采用 <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/" target="_blank"> CC BY 3.0 CN </a> 许可协议。可自由转载、引用，但需署名作者且注明文章出处。如转载至微信公众号，请在文末添加作者公众号二维码。
                    
                </div>
                <div>
                    
                </div>
            </div>
            <div class="col-sm-2">
                <img src="/icons/wx.jpg" width=100%/>
            </div>
        </div>
    
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a target="_blank" href="/springboot/springboot-fastdfs/" class="pre-post btn btn-default"
           title='SpringBoot2.x整合FastDFS'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">SpringBoot2.x整合FastDFS</span>
        </a>
    
    
        <a target="_blank" href="/redis/redis-and-memcache/" class="next-post btn btn-default"
           title='对Redis的理解，Redis是什么，Redis和Memcache谁快？'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">对Redis的理解，Redis是什么，Redis和Memcache谁快？</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
   <p>评论系统未开启，无法评论！</p>

    </div>






                </main>
                
    <aside class="col-md-4 sidebar">
        
        <div class="widget about-me">
    <div class="row">
        <div class="col-md-5">
            <img src="/icons/wx.jpg" alt="公众号" class="img-responsive center-block">
        </div>
        <div class="col-md-7">
            <a class="series-a" href="javascript:void(0)">公众号</a>
            <ul>
                <li>• 技术干货推送</li>
                <li>• 日常好文分享</li>
                <li><b>• 扫码领取更多惊喜</b></li>
            </ul>
        </div>
    </div>
    
<!--        <div class="row">-->
<!--            <div class="col-md-5">-->
<!--                <img src="/icons/xcx.jpg" alt="小程序" class="img-responsive">-->
<!--            </div>-->
<!--            <div class="col-md-7">-->
<!--                <a class="series-a" href="javascript:void(0)">小程序</a>-->
<!--                <ul>-->
<!--                    <li>• 原创笔记</li>-->
<!--                    <li>• 独家心法</li>-->
<!--                    <li><b>• 扫码领取</b></li>-->
<!--                </ul>-->
<!--            </div>-->
<!--        </div>-->
    
</div>




        
        
    <div class="widget">
        <h3 class="title">网站公告</h3>
        <div class="notification">
            <p>
  <b>QQ群</b>：415777345<br/>
</p>

<p>
<b>联系博主QQ</b>：210006540<br/>
</p>
        </div>
    </div>

        
        
    
        <div class="ad">
            <div class="row">
                <div class="col-md-12">
                    <a href="https://promotion.aliyun.com/ntms/act/qwbk.html?userCode=qhtujh03" rel="nofollow" target="_blank">
                        <img class="img-responsive center-block"
                             title="阿里全民云计算"
                             src="/icons/380-120.png"
                        >
                    </a>
                </div>
            </div>
        </div>
    




        
        
    <div class="widget">
        <h3 class="title">分类</h3>
        <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Ajax/"><i class="fa" aria-hidden="true">Ajax</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/"><i class="fa" aria-hidden="true">Docker</i></a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Druid/"><i class="fa" aria-hidden="true">Druid</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Feign/"><i class="fa" aria-hidden="true">Feign</i></a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP/"><i class="fa" aria-hidden="true">HTTP</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/"><i class="fa" aria-hidden="true">Hexo</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JRebel/"><i class="fa" aria-hidden="true">JRebel</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/"><i class="fa" aria-hidden="true">Java</i></a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Maven/"><i class="fa" aria-hidden="true">Maven</i></a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MongoDB/"><i class="fa" aria-hidden="true">MongoDB</i></a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/"><i class="fa" aria-hidden="true">MySQL</i></a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nexus3-x/"><i class="fa" aria-hidden="true">Nexus3.x</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PowerShell/"><i class="fa" aria-hidden="true">PowerShell</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Quartz/"><i class="fa" aria-hidden="true">Quartz</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/"><i class="fa" aria-hidden="true">Redis</i></a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RocketMQ/"><i class="fa" aria-hidden="true">RocketMQ</i></a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Sharding-JDBC/"><i class="fa" aria-hidden="true">Sharding-JDBC</i></a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/"><i class="fa" aria-hidden="true">Spring</i></a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Cloud/"><i class="fa" aria-hidden="true">Spring Cloud</i></a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringBoot/"><i class="fa" aria-hidden="true">SpringBoot</i></a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringCloud-Alibaba/"><i class="fa" aria-hidden="true">SpringCloud Alibaba</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringSession/"><i class="fa" aria-hidden="true">SpringSession</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/主键/"><i class="fa" aria-hidden="true">主键</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/其他/"><i class="fa" aria-hidden="true">其他</i></a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link current" href="/categories/安装教程/"><i class="fa" aria-hidden="true">安装教程</i></a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/"><i class="fa" aria-hidden="true">工具</i></a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/微服务/"><i class="fa" aria-hidden="true">微服务</i></a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/"><i class="fa" aria-hidden="true">数据库</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试/"><i class="fa" aria-hidden="true">面试</i></a><span class="category-list-count">1</span></li></ul>
    </div>


        
        
  <div class="widget">
    <h3 class="title">标签云</h3>
    <div class="content tag-cloud">
        
            <canvas width="300" height="300" id="tag-cloud-3d">
                <a href="/tags/Ajax/" style="font-size: 10px;">Ajax</a> <a href="/tags/Alibaba/" style="font-size: 10px;">Alibaba</a> <a href="/tags/Banner/" style="font-size: 10px;">Banner</a> <a href="/tags/Centos/" style="font-size: 10px;">Centos</a> <a href="/tags/Docker/" style="font-size: 18.18px;">Docker</a> <a href="/tags/Druid/" style="font-size: 10px;">Druid</a> <a href="/tags/Eureka/" style="font-size: 10.91px;">Eureka</a> <a href="/tags/FastDFS/" style="font-size: 10.91px;">FastDFS</a> <a href="/tags/Feign/" style="font-size: 13.64px;">Feign</a> <a href="/tags/File/" style="font-size: 10px;">File</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Hexo/" style="font-size: 10.91px;">Hexo</a> <a href="/tags/HikariCP/" style="font-size: 10px;">HikariCP</a> <a href="/tags/Hystrix/" style="font-size: 10.91px;">Hystrix</a> <a href="/tags/Hystrix-Dashboard/" style="font-size: 10px;">Hystrix Dashboard</a> <a href="/tags/IDEA/" style="font-size: 10px;">IDEA</a> <a href="/tags/JDK/" style="font-size: 10px;">JDK</a> <a href="/tags/JRebel/" style="font-size: 10px;">JRebel</a> <a href="/tags/Java/" style="font-size: 12.73px;">Java</a> <a href="/tags/Java-b2-spring注解/" style="font-size: 16.36px;">Java-b2-spring注解</a> <a href="/tags/Map/" style="font-size: 10px;">Map</a> <a href="/tags/Maven/" style="font-size: 12.73px;">Maven</a> <a href="/tags/Memcache/" style="font-size: 10px;">Memcache</a> <a href="/tags/MongoDB/" style="font-size: 10.91px;">MongoDB</a> <a href="/tags/MongoTemplate/" style="font-size: 10.91px;">MongoTemplate</a> <a href="/tags/MySQL/" style="font-size: 15.45px;">MySQL</a> <a href="/tags/MySQL8/" style="font-size: 10px;">MySQL8</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/Navicat/" style="font-size: 10px;">Navicat</a> <a href="/tags/Nexus3-x/" style="font-size: 10.91px;">Nexus3.x</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/PowerShell/" style="font-size: 10px;">PowerShell</a> <a href="/tags/Quartz/" style="font-size: 10px;">Quartz</a> <a href="/tags/RabbitMQ/" style="font-size: 10px;">RabbitMQ</a> <a href="/tags/Redis/" style="font-size: 12.73px;">Redis</a> <a href="/tags/Ribbon/" style="font-size: 10.91px;">Ribbon</a> <a href="/tags/RocketMQ/" style="font-size: 19.09px;">RocketMQ</a> <a href="/tags/Sharding-JDBC/" style="font-size: 14.55px;">Sharding-JDBC</a> <a href="/tags/SonarQube/" style="font-size: 10px;">SonarQube</a> <a href="/tags/Spring/" style="font-size: 17.27px;">Spring</a> <a href="/tags/Spring-Boot/" style="font-size: 11.82px;">Spring Boot</a> <a href="/tags/Spring-Cloud/" style="font-size: 17.27px;">Spring Cloud</a> <a href="/tags/Spring-Cloud-Gateway/" style="font-size: 10.91px;">Spring Cloud Gateway</a> <a href="/tags/Spring-Cloud-Sleuth/" style="font-size: 10px;">Spring Cloud Sleuth</a> <a href="/tags/SpringBoot/" style="font-size: 20px;">SpringBoot</a> <a href="/tags/SpringCloud/" style="font-size: 10.91px;">SpringCloud</a> <a href="/tags/SpringCloud-Alibaba/" style="font-size: 10px;">SpringCloud Alibaba</a> <a href="/tags/SpringCloud-Stream/" style="font-size: 10px;">SpringCloud Stream</a> <a href="/tags/SpringSession/" style="font-size: 10px;">SpringSession</a> <a href="/tags/Tomcat/" style="font-size: 10px;">Tomcat</a> <a href="/tags/Transaction/" style="font-size: 10px;">Transaction</a> <a href="/tags/Turbine/" style="font-size: 10px;">Turbine</a> <a href="/tags/Web应用/" style="font-size: 10px;">Web应用</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/Windows-11/" style="font-size: 10px;">Windows 11</a> <a href="/tags/Zipkin/" style="font-size: 10px;">Zipkin</a> <a href="/tags/Zookeeper/" style="font-size: 10px;">Zookeeper</a> <a href="/tags/Zuul/" style="font-size: 10px;">Zuul</a> <a href="/tags/annotation/" style="font-size: 10px;">annotation</a> <a href="/tags/assessToken/" style="font-size: 10px;">assessToken</a> <a href="/tags/httpclient/" style="font-size: 10px;">httpclient</a> <a href="/tags/logback/" style="font-size: 10px;">logback</a> <a href="/tags/session共享/" style="font-size: 10px;">session共享</a> <a href="/tags/theme/" style="font-size: 10px;">theme</a> <a href="/tags/互联网产品/" style="font-size: 10px;">互联网产品</a> <a href="/tags/其他/" style="font-size: 10px;">其他</a> <a href="/tags/分布式/" style="font-size: 10.91px;">分布式</a> <a href="/tags/加密/" style="font-size: 10px;">加密</a> <a href="/tags/原理/" style="font-size: 10px;">原理</a> <a href="/tags/发布/" style="font-size: 10px;">发布</a> <a href="/tags/图片水印/" style="font-size: 10px;">图片水印</a> <a href="/tags/工具/" style="font-size: 10px;">工具</a> <a href="/tags/并发编程/" style="font-size: 10px;">并发编程</a> <a href="/tags/循环依赖/" style="font-size: 10px;">循环依赖</a> <a href="/tags/微服务/" style="font-size: 20px;">微服务</a> <a href="/tags/时间工具类/" style="font-size: 10px;">时间工具类</a> <a href="/tags/注解/" style="font-size: 10.91px;">注解</a> <a href="/tags/消息订阅/" style="font-size: 10px;">消息订阅</a> <a href="/tags/索引/" style="font-size: 14.55px;">索引</a> <a href="/tags/红黑树/" style="font-size: 10px;">红黑树</a>
            </canvas>
        
    </div>
  </div>


        
        
    <div class="widget">
        <h3 class="title">归档</h3>
        <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/"><i class="fa" aria-hidden="true">2023年07月</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/"><i class="fa" aria-hidden="true">2022年09月</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/"><i class="fa" aria-hidden="true">2022年05月</i></a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/"><i class="fa" aria-hidden="true">2021年07月</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/"><i class="fa" aria-hidden="true">2021年06月</i></a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/"><i class="fa" aria-hidden="true">2021年03月</i></a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/"><i class="fa" aria-hidden="true">2021年02月</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/"><i class="fa" aria-hidden="true">2020年11月</i></a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/"><i class="fa" aria-hidden="true">2020年09月</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/"><i class="fa" aria-hidden="true">2020年08月</i></a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/"><i class="fa" aria-hidden="true">2020年07月</i></a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/"><i class="fa" aria-hidden="true">2020年06月</i></a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/"><i class="fa" aria-hidden="true">2020年04月</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/"><i class="fa" aria-hidden="true">2020年03月</i></a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/"><i class="fa" aria-hidden="true">2020年02月</i></a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/"><i class="fa" aria-hidden="true">2020年01月</i></a><span class="archive-list-count">23</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/"><i class="fa" aria-hidden="true">2019年12月</i></a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/"><i class="fa" aria-hidden="true">2019年11月</i></a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/"><i class="fa" aria-hidden="true">2019年10月</i></a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/"><i class="fa" aria-hidden="true">2019年09月</i></a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/"><i class="fa" aria-hidden="true">2019年08月</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/"><i class="fa" aria-hidden="true">2019年05月</i></a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/"><i class="fa" aria-hidden="true">2019年04月</i></a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/"><i class="fa" aria-hidden="true">2019年03月</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/"><i class="fa" aria-hidden="true">2019年02月</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/"><i class="fa" aria-hidden="true">2019年01月</i></a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/"><i class="fa" aria-hidden="true">2018年12月</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/"><i class="fa" aria-hidden="true">2018年10月</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/"><i class="fa" aria-hidden="true">2018年09月</i></a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/"><i class="fa" aria-hidden="true">2018年08月</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/"><i class="fa" aria-hidden="true">2018年06月</i></a><span class="archive-list-count">2</span></li></ul>
    </div>


        
        
    <div class="widget">
      <h3 class="title">社交</h3> 
        <div class="content social">
            
	            <a href="//github.com/zhaokejin" rel="external nofollow" title="GitHub" target="_blank">
			    	<i class="github fa fa-github"></i>
			    </a>
            
	            <a href="//gitee.com/zhaokejin" rel="external nofollow" title="Gitee" target="_blank">
			    	<i class="git fa fa-git"></i>
			    </a>
            
	            <a href="mailto:210006540qq.com" rel="external nofollow" title="邮箱" target="_blank">
			    	<i class="envelope-o fa fa-envelope-o"></i>
			    </a>
            
	            <a href="//wpa.qq.com/msgrd?v=3&uin=210006540&site=qq&menu=yes" rel="external nofollow" title="QQ" target="_blank">
			    	<i class="qq fa fa-qq"></i>
			    </a>
            
	            <a href="//shang.qq.com/wpa/qunwpa?idkey=7b19717710dcc2c78996f316db3ab3365bde39bc3c60de7a6c59fe07231e231a" rel="external nofollow" title="QQ群" target="_blank">
			    	<i class="group fa fa-group"></i>
			    </a>
            
	            <a href="/atom.xml" rel="external nofollow" title="RSS" target="_blank">
			    	<i class="feed fa fa-feed"></i>
			    </a>
            
        </div>
    </div>


        
        

        
    </aside>

            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
        访问量:
        <strong id="busuanzi_value_site_pv">
            <i class="fa fa-spinner fa-spin"></i>
        </strong>
        &nbsp; | &nbsp;
        访客数:
        <strong id="busuanzi_value_site_uv">
            <i class="fa fa-spinner fa-spin"></i>
        </strong>
<!--        &nbsp; <strong>Since 2018-12-26</strong>-->
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2018 - 2023
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    <a href="//beian.miit.gov.cn/" class="copyright-links" target="_blank" rel="nofollow">鲁ICP备18033870号</a>
                </span>
            </div>
        </div>
    </div>
</div>

<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/bootstrap-hover-dropdown.min.js"></script>


	<script src="/js/search.js?rev=@@hash"></script>



    <script src="/assets/tagcanvas.min.js?rev=2.9"></script>
    <script>
        var tagOption = {
            textColour: '#29afec', // 字体颜色
            outlineMethod: 'block', // 选中模式
            outlineColour: '#FFDAB9', // 选中模式的颜色
            interval: 30 || 30, // 动画帧之间的时间间隔，值越大，转动幅度越大
            textHeight: 13,
            outlineRadius: 3,
            freezeActive: true || '', // 选中的标签是否继续滚动
            frontSelect: true || '', // 不选标签云后部的标签
            initial: [0.1, -0.1],
            depth: 0.5,
            decel: 0.95,
            maxSpeed: 0.03,
            reverse: true || '', // 是否反向触发
            fadeIn: 500, // 进入动画时间
            wheelZoom: false || '' // 是否启用鼠标滚轮
        }
        TagCanvas.Start('tag-cloud-3d','',tagOption);
    </script>



    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<script src="/js/app.js?rev=@@hash"></script>
<script src="/jquery.fancybox.js?v=2.1.5"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $('.fancybox').fancybox();
    });
    // 给图片添加链接
    $(document).ready(function() {
        $("p img").each(function() {
            var strA = "<a id='yourid' class='fancybox' data-fancybox-group='gallery'  href='" + this.src + "'></a>";
            $(this).wrapAll(strA);
        });
    });
    // fancybox
    $("#yourid").fancybox({
        openEffect    : 'elastic',
        closeEffect   : 'elastic',
    });
</script>

</body>
</html>